<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>执手对影成双 - JS 啊，JS</title>
  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154705931-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-154705931-1');
  </script>

  <meta property="og:title" content="执手对影成双 | pengkun Lee">
  <meta property="og:type" content="website">
  <meta name="keywords" content="个人网站,博客">
  <meta name="baidu-site-verification" content="DjOoDNzsC0">
  <script>
    console.info(
      "%c自主%c、%c跨界%c、%c终身学习%c。",
      "color:#E24432; font-size: 16px;","color:#666666; font-size: 16px;",
      "color:#0E70ED; font-size: 16px;","color:#666666; font-size: 16px;",
      "color:#009E5E; font-size: 16px;","color:#666666; font-size: 16px;");
  </script>
  
  
  

  
  
  <meta property="description" content="关于评论和黑夜白天模式切换的 JS ，我修改了好多次。
但是一直都会在修改几天后，自己再使用时发现可以优化的地方。就在昨天晚上，我发现了一个问题——评论模式切换的提示无法显示了。
由于评论是异步 JS 加载的，而且 iframe 跨域，所以在评论加载完毕后，切换页面的阅读模式后，在评论区上方有个“切换评论阅读模式”的提示。
经过调试，我没有发现 darkmode.js 中有任何错误。
我然后认为是 &amp;hellip;">
  <meta property="og:description" content="关于评论和黑夜白天模式切换的 JS ，我修改了好多次。
但是一直都会在修改几天后，自己再使用时发现可以优化的地方。就在昨天晚上，我发现了一个问题——评论模式切换的提示无法显示了。
由于评论是异步 JS 加载的，而且 iframe 跨域，所以在评论加载完毕后，切换页面的阅读模式后，在评论区上方有个“切换评论阅读模式”的提示。
经过调试，我没有发现 darkmode.js 中有任何错误。
我然后认为是 &amp;hellip;">
  
  

  
  

  <link rel="icon" type="image/x-icon" href="/zsdycs_favicon.ico">
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/fonts.css" />
  <script async src="/js/load-typekit.js"></script>
<script src="/js/darkmode-js.min.js"></script>
<script src="/js/get-url-relative-path.js"></script>
<link rel="stylesheet" href="/css/custom.css" />
<link rel="stylesheet" href="/css/loading.css" />
</head>



<body class="blog">
  <div class="paramount">
  <header class="masthead">
    <h1>
  <img src="https://zsdycs.sirv.com/zsdycs.cn/logo.png" alt="执手对影成双" />
</h1>


    <nav class="menu">
  <ul>
    
    
    <li><a href="/">返回</a></li>
      
    <li><a href="/blog/">博客</a></li>
      
    <li><a href="/food/">美食</a></li>
      
      




<li><a href="http://github.com/zsdycs/zsdycs.cn/edit/master/content/blog/2020-04-21-JS-JS.md" title="编辑本页"
    target="_blank">
    编辑
  </a></li>
<li><a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" title="版权声明" target="_blank">
    版权
  </a></li>



  </ul>
</nav>

  </header>

  <article class="main">
    <header class="title">
      
<h1>JS 啊，JS</h1>

<h3>
     
    李鹏坤 / 2020-04-21
</h3>
<hr>


    </header>
    


<p>关于评论和黑夜白天模式切换的 JS ，我修改了好多次。</p>
<p>但是一直都会在修改几天后，自己再使用时发现可以优化的地方。就在昨天晚上，我发现了一个问题——评论模式切换的提示无法显示了。</p>
<p>由于评论是异步 JS 加载的，而且 iframe 跨域，所以在评论加载完毕后，切换页面的阅读模式后，在评论区上方有个“切换评论阅读模式”的提示。</p>
<p>经过调试，我没有发现 <a href="https://github.com/zsdycs/zsdycs.cn/blob/master/static/js/darkmode.js">darkmode.js</a> 中有任何错误。</p>
<p>我然后认为是加载顺序的问题，这个跟是否 <code>async</code> 没有关系。<br>
我打印了 <code>insertBefore</code> 后的元素，发现 DOM 操作是执行了的，可是其并没有反应到页面上！</p>
<p>为什么？</p>
<p>思前想后，我认为是我代码写得不规范。</p>
<p>首先，我在那一大段正则后加上了 <code>;</code> ，然后把获取的 <code>DOM</code> 元素变量，都放到离 <code>DOM</code> 操作最接近的地方，以免该变量被修改，或过早获取。
最后，我把 <code>const</code> 和 <code>let</code> 都改为了 <code>var</code>。</p>
<p>结果这个问题解决了。 <a href="https://github.com/zsdycs/zsdycs.cn/commit/4313cd83a4fc87e7cbd7dc77e523507493b77e24">代码履历</a></p>
<hr>
<p>这个事情引起了我的反思。</p>
<p>做前端开发快一年了，一直都在 Angular 和 Vue 的温室下。写的是 typeScript ，浏览器最后执行的代码是 webpack 编译后的 JS ，
生命周期，处理顺序都被安排得明明白白的，基本上不需要思考。</p>
<p>基础太关键了。</p>
<h4 id="版权声明httpszsdycssirvcomzsdycscncreativecommons-ccsvghttpscreativecommonsorglicensesby-nc-nd40"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><img src="https://zsdycs.sirv.com/zsdycs.cn/creativecommons-cc.svg" alt="版权声明"></a></h4>

<footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/blog/2020/04/16/body-background-image-fade-in/" title="你可以使用方向键">Body，你的背景图片怎么淡入哇？</a></span>
  <span class="nav-next"></span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/blog\/2020\/04\/16\/body-background-image-fade-in\/';
    
  } else if (e.which == 39) {  
    
  }
  if (url) window.location = url;
});
</script>



<section id="utterances" class="comments">
  <div id="loading">
    <div class="container animation-2">
      <div class="shape shape1"></div>
      <div class="shape shape2"></div>
      <div class="shape shape3"></div>
      <div class="shape shape4"></div>
    </div>
  </div>
</section>


<script async src="/js/darkmode.js"></script>

<script async src="/js/utteranc.js"></script>

<script async src="/js/fix-toc.js"></script>

<script async src="/js/math-code.js"></script>

<script async src="/js/center-img.js"></script>

<script async src="/js/right-quote.js"></script>

<script async src="/js/no-highlight.js"></script>

<script async src="/js/fix-footnote.js"></script>

<script async src="/js/external-link.js"></script>

<script async src="/js/alt-title.js"></script>




  
  <hr>
  <div class="copyright" id="add-icp">
    <span id="slogan">执手相看，对影成双</span>
    © <a href="/">执手对影成双</a> 2018 - 2020
  </div>
  
</footer>
</article>
</div>
</body>

</html>
